
[include mainsail.cfg]


[mcu scanner]
canbus_uuid: 7ab466af93f3
#serial: /dev/serial/by-id/usb-cartographer_cartographer_
#    adjust to suit your scanner, if using usb change to serial

[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 23                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.01122
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 175, 175    
#    set this to the middle of your bed
speed: 400
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 50, 25
#    start point of bed mesh [X, Y]
mesh_max: 300, 275
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[include Manta-bigtreetech.cfg]

[include bigtreetech-EBBCan.cfg]

[include config_backup.cfg]

[include Macros.cfg]

[mcu EBBCan]
#serial /dev/serial/by-id/usb-Klipper_firmware_12345-if00
canbus_uuid: 2737fcca382f

[mcu]
#serial /dev/serial/by-id/usb-Klipper_firmware_12345-if00
canbus_uuid: 96438189e9b5

# Below you can include specific configuration files depending on what you want KAMP to do:

#[include ./KAMP/Adaptive_Meshing.cfg]       # Include to enable adaptive meshing configuration.
#[include ./KAMP/Line_Purge.cfg]             # Include to enable adaptive line purging configuration.
[include ./KAMP/Voron_Purge.cfg]            # Include to enable adaptive Voron logo purging configuration.
[include ./KAMP/Smart_Park.cfg]             # Include to enable the Smart Park function, which parks the printhead near the print area for final heating.

[gcode_macro _KAMP_Settings]
description: This macro contains all adjustable settings for KAMP 

# The following variables are settings for KAMP as a whole.
variable_verbose_enable: True               # Set to True to enable KAMP information output when running. This is useful for debugging.

# The following variables are for adjusting adaptive mesh settings for KAMP.
variable_mesh_margin: 0                     # Expands the mesh size in millimeters if desired. Leave at 0 to disable.
variable_fuzz_amount: 0                     # Slightly randomizes mesh points to spread out wear from nozzle-based probes. Leave at 0 to disable.

# The following variables are for those with a dockable probe like Klicky, Euclid, etc.                 # ----------------  Attach Macro | Detach Macro
variable_probe_dock_enable: False           # Set to True to enable the usage of a dockable probe.      # ---------------------------------------------
variable_attach_macro: 'Attach_Probe'       # The macro that is used to attach the probe.               # Klicky Probe:   'Attach_Probe' | 'Dock_Probe'
variable_detach_macro: 'Dock_Probe'         # The macro that is used to store the probe.                # Euclid Probe:   'Deploy_Probe' | 'Stow_Probe'
                                                                                                        # Legacy Gcode:   'M401'         | 'M402'

# The following variables are for adjusting adaptive purge settings for KAMP.
variable_purge_height: 0.8                  # Z position of nozzle during purge, default is 0.8.
variable_tip_distance: 0                    # Distance between tip of filament and nozzle before purge. Should be similar to PRINT_END final retract amount.
variable_purge_margin: 10                   # Distance the purge will be in front of the print area, default is 10.
variable_purge_amount: 30                   # Amount of filament to be purged prior to printing.
variable_flow_rate: 12                      # Flow rate of purge in mm3/s. Default is 12.

# The following variables are for adjusting the Smart Park feature for KAMP, which will park the printhead near the print area at a specified height.
variable_smart_park_height: 10              # Z position for Smart Park, default is 10.

gcode: # Gcode section left intentionally blank. Do not disturb.

    {action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}
#####################################################################
#	Probe
#####################################################################

#[bltouch]
#sensor_pin: ^EBBCan: PB8
#control_pin: EBBCan: PB9

## NPN and PNP proximity switch types can be set by jumper
#[probe]
#pin: endstop_pin: probe:z_virtual_endstop
#x_offset: 0
#y_offset: 0
#z_offset: 0
#speed: 5.0     # when using induction, set to 10
#lift_speed: 10 #remove when using induction
#samples: 3
#samples_result: median
#sample_retract_dist: 3.0
#samples_tolerance: 0.006
#samples_tolerance_retries: 4
#activate_gcode:
    #{% set PROBE_TEMP = 180 %}
    #{% set MAX_TEMP = PROBE_TEMP + 5 %}
    #{% set ACTUAL_TEMP = printer.extruder.temperature %}
    #{% set TARGET_TEMP = printer.extruder.target %}

    #{% if TARGET_TEMP > PROBE_TEMP %}
        #{ action_respond_info('Extruder temperature target of %.1fC is too high, lowering to %.1fC' % (TARGET_TEMP, PROBE_TEMP)) }
        #M109 S{ PROBE_TEMP }
    #{% else %}
        # Temperature target is already low enough, but nozzle may still be too hot.
        #{% if ACTUAL_TEMP > MAX_TEMP %}
           # { action_respond_info('Extruder temperature %.1fC is still too high, waiting until below %.1fC' % (ACTUAL_TEMP, MAX_TEMP)) }
            #TEMPERATURE_WAIT SENSOR=extruder MAXIMUM={ MAX_TEMP }
        #{% endif %}
    #{% endif %}

[input_shaper]
shaper_type_x = 3hump_ei
damping_ratio_x: 0.133
shaper_freq_x = 73.2
shaper_type_y = mzv
shaper_freq_y = 34 
damping_ratio_y: 0.062

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.


#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe]
#*# z_offset = -0.830
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.018822, -0.008743, -0.001206, 0.002790, 0.000338, -0.001648, -0.003502, 0.004844, 0.012820, 0.022762, 0.034596, 0.044904, 0.047868, 0.049524, 0.051336, 0.053439, 0.055621, 0.057063, 0.060066, 0.067057, 0.071425, 0.068053, 0.061599, 0.054997, 0.048601, 0.039000, 0.022857, 0.009549, -0.000968, -0.008663
#*# 	  -0.023656, -0.013027, -0.006199, -0.000204, 0.000211, -0.000029, 0.001797, 0.005888, 0.009800, 0.018895, 0.028360, 0.036797, 0.039482, 0.039925, 0.041191, 0.044153, 0.046052, 0.047717, 0.052463, 0.057251, 0.061927, 0.059118, 0.054499, 0.044872, 0.039389, 0.028991, 0.015981, 0.000434, -0.010453, -0.017533
#*# 	  -0.024008, -0.013240, -0.006432, -0.002202, 0.000946, 0.001426, 0.006593, 0.007935, 0.011142, 0.017254, 0.026038, 0.032604, 0.035647, 0.035377, 0.039539, 0.039600, 0.041297, 0.044473, 0.046859, 0.053239, 0.057236, 0.055381, 0.047134, 0.039438, 0.031475, 0.020403, 0.006616, -0.007672, -0.017046, -0.023179
#*# 	  -0.028373, -0.016403, -0.011049, -0.009958, -0.007391, -0.006337, 0.001059, 0.002623, 0.004842, 0.012179, 0.018287, 0.024829, 0.027455, 0.028225, 0.032657, 0.030510, 0.032733, 0.036706, 0.037905, 0.044278, 0.048274, 0.045109, 0.040190, 0.031441, 0.025319, 0.016258, -0.002559, -0.015069, -0.025361, -0.031356
#*# 	  -0.024877, -0.016118, -0.009090, -0.012511, -0.009830, -0.008072, -0.001513, 0.005776, 0.009520, 0.012517, 0.019126, 0.024825, 0.028165, 0.029304, 0.030684, 0.030844, 0.030021, 0.036285, 0.039193, 0.043245, 0.046176, 0.043488, 0.036766, 0.027091, 0.019612, 0.009773, -0.006037, -0.020258, -0.032321, -0.039418
#*# 	  -0.026991, -0.019318, -0.016408, -0.017025, -0.019104, -0.015810, -0.007274, 0.001048, 0.002574, 0.004605, 0.011685, 0.017276, 0.020724, 0.021717, 0.022201, 0.021563, 0.022162, 0.027560, 0.031260, 0.034175, 0.035399, 0.033235, 0.026289, 0.016527, 0.010150, 0.001612, -0.014913, -0.028389, -0.041345, -0.049480
#*# 	  -0.028034, -0.019934, -0.015623, -0.020240, -0.020577, -0.018772, -0.008768, -0.001160, 0.000918, 0.002519, 0.007888, 0.014041, 0.018844, 0.022621, 0.019617, 0.017585, 0.017540, 0.020663, 0.023659, 0.025830, 0.026576, 0.024184, 0.019269, 0.009831, 0.001508, -0.009194, -0.024815, -0.037353, -0.049520, -0.059673
#*# 	  -0.027826, -0.020740, -0.016046, -0.019483, -0.023565, -0.018302, -0.009384, -0.004464, -0.003943, -0.003428, 0.002785, 0.008249, 0.012466, 0.014148, 0.014155, 0.016661, 0.013619, 0.012023, 0.015825, 0.018007, 0.018025, 0.016054, 0.009407, -0.011290, -0.006259, -0.016682, -0.031601, -0.047642, -0.056585, -0.064943
#*# 	  -0.026924, -0.019486, -0.013225, -0.017174, -0.021209, -0.019121, -0.009576, -0.003060, -0.003365, -0.000692, 0.002751, 0.010183, 0.014150, 0.016051, 0.020117, 0.017878, 0.015623, 0.014332, 0.015693, 0.015581, 0.017020, 0.014225, 0.008803, -0.002035, -0.009810, -0.020267, -0.036781, -0.051588, -0.063553, -0.071512
#*# 	  -0.031051, -0.024598, -0.018402, -0.023293, -0.026551, -0.023164, -0.015835, -0.008940, -0.008487, -0.006274, -0.002140, 0.003875, 0.008233, 0.010593, 0.014195, 0.013431, 0.010655, 0.009136, 0.008485, 0.010120, 0.010351, 0.008243, 0.001307, -0.010499, -0.018242, -0.027368, -0.044834, -0.059109, -0.072940, -0.079797
#*# 	  -0.034075, -0.027068, -0.019654, -0.024157, -0.027401, -0.031975, -0.017796, -0.011827, -0.009356, -0.007004, -0.002826, 0.004893, 0.009689, 0.012820, 0.014727, 0.014257, 0.011515, 0.009212, 0.009810, 0.009745, 0.009568, 0.007452, -0.003740, -0.015184, -0.023757, -0.033005, -0.047761, -0.063872, -0.077152, -0.086789
#*# 	  -0.033825, -0.026269, -0.027649, -0.024107, -0.027627, -0.023748, -0.017515, -0.011938, -0.010214, -0.007489, -0.003848, 0.003376, 0.008922, 0.010439, 0.013054, 0.011785, 0.009468, 0.009539, 0.008764, 0.009569, 0.010498, 0.004838, -0.006209, -0.016570, -0.025089, -0.035091, -0.050857, -0.065881, -0.078327, -0.089683
#*# 	  -0.033579, -0.026930, -0.021355, -0.024973, -0.029738, -0.027278, -0.020145, -0.016644, -0.014993, -0.012522, -0.007458, 0.002387, 0.005402, 0.006879, 0.006879, 0.007080, 0.005950, 0.004932, 0.005667, 0.006870, 0.022814, 0.003732, -0.007912, -0.022201, -0.031705, -0.041144, -0.057658, -0.072009, -0.082845, -0.094393
#*# 	  -0.032656, -0.028474, -0.022606, -0.025812, -0.031558, -0.028833, -0.022207, -0.017355, -0.015950, -0.013962, -0.010232, -0.001151, 0.003160, 0.003698, 0.002458, 0.001841, -0.010110, 0.002380, 0.002579, 0.003673, 0.004259, 0.000330, -0.009868, -0.025021, -0.033255, -0.041204, -0.057595, -0.070926, -0.081458, -0.092850
#*# 	  -0.035597, -0.030329, -0.026567, -0.029594, -0.033439, -0.031672, -0.021781, -0.020490, -0.018420, -0.017180, -0.012711, -0.005936, -0.003230, -0.005023, -0.005129, -0.006015, -0.006069, -0.003666, -0.002945, 0.000814, 0.002135, -0.000579, -0.011447, -0.029940, -0.037226, -0.045761, -0.075149, -0.074317, -0.102404, -0.094832
#*# 	  -0.044725, -0.033598, -0.028829, -0.032239, -0.036692, -0.032833, -0.027269, -0.023240, -0.021059, -0.020570, -0.010089, -0.011261, -0.009845, -0.011080, -0.012218, -0.012032, -0.013170, -0.012410, -0.006386, -0.002255, -0.001343, -0.004836, -0.014942, -0.029436, -0.037590, -0.046272, -0.061241, -0.074592, -0.084304, -0.094018
#*# 	  -0.042212, -0.033660, -0.030179, -0.032800, -0.034781, -0.032492, -0.027344, -0.024002, -0.022873, -0.022931, -0.018770, -0.013007, -0.017613, -0.013664, -0.014587, -0.016072, -0.016056, -0.014521, -0.008612, -0.002726, -0.000495, -0.005791, -0.017278, -0.030637, -0.038354, -0.048540, -0.064223, -0.078751, -0.088031, -0.093627
#*# 	  -0.040864, -0.030444, -0.029124, -0.029729, -0.032725, -0.029413, -0.024732, -0.022753, -0.021926, -0.020139, -0.017403, -0.011524, -0.009164, -0.010735, -0.011599, -0.012763, -0.012088, -0.008959, -0.002692, 0.002247, 0.001925, -0.004018, -0.015104, -0.024655, -0.027290, -0.045934, -0.063172, -0.077252, -0.085114, -0.092248
#*# 	  -0.043374, -0.036010, -0.032209, -0.032506, -0.032494, -0.032758, -0.030353, -0.025493, -0.024026, -0.023810, -0.019468, -0.013234, -0.011017, -0.012339, -0.013110, -0.012526, -0.012262, -0.010629, -0.005580, -0.002117, -0.001171, -0.004677, -0.016214, -0.026511, -0.036184, -0.049889, -0.066597, -0.067976, -0.088910, -0.095989
#*# 	  -0.048208, -0.039350, -0.032761, -0.032463, -0.034776, -0.034404, -0.030451, -0.027384, -0.025950, -0.025714, -0.018379, -0.013776, -0.009709, -0.011670, -0.011642, -0.012556, -0.012091, -0.010825, -0.012929, -0.003140, -0.001023, -0.004493, -0.013427, -0.023176, -0.032788, -0.045357, -0.062093, -0.073885, -0.082999, -0.091946
#*# 	  -0.047053, -0.036992, -0.031457, -0.034664, -0.037588, -0.035032, -0.031021, -0.027169, -0.023625, -0.022100, -0.016715, -0.011338, -0.007957, -0.004357, -0.010105, -0.010533, -0.010746, -0.009829, -0.009431, -0.005291, -0.000262, -0.002255, -0.011804, -0.024231, -0.033280, -0.044343, -0.058047, -0.071087, -0.078796, -0.088647
#*# 	  -0.044293, -0.033699, -0.029614, -0.032448, -0.035796, -0.033542, -0.028152, -0.023645, -0.022558, -0.019876, -0.014655, -0.006695, -0.002129, -0.005557, -0.004966, -0.006885, -0.006381, -0.008617, -0.005536, -0.000163, 0.001821, -0.000651, -0.011233, -0.021946, -0.026319, -0.037255, -0.052215, -0.063359, -0.072960, -0.080176
#*# 	  -0.045869, -0.037438, -0.035821, -0.039002, -0.039399, -0.036789, -0.030540, -0.024871, -0.023025, -0.020772, -0.014776, -0.007161, -0.003913, -0.003706, -0.004839, -0.008016, -0.009510, -0.009951, -0.006524, -0.003947, 0.001545, -0.003328, -0.010810, -0.020917, -0.026362, -0.035844, -0.050430, -0.064963, -0.072131, -0.078050
#*# 	  -0.047058, -0.038404, -0.036564, -0.039641, -0.043503, -0.039627, -0.033367, -0.027995, -0.023874, -0.022672, -0.015446, -0.007641, -0.001808, -0.002592, -0.004759, -0.008479, -0.009890, -0.007034, -0.004725, -0.000106, -0.001109, -0.002837, -0.008557, -0.017918, -0.022899, -0.033746, -0.047799, -0.062642, -0.070490, -0.074006
#*# 	  -0.047984, -0.038524, -0.033803, -0.036193, -0.039518, -0.036321, -0.028959, -0.023689, -0.023949, -0.021206, -0.015000, -0.007167, -0.000214, -0.002000, -0.003094, -0.003647, -0.004364, -0.003748, -0.000173, -0.000236, 0.002468, 0.003064, -0.005360, -0.015906, -0.020721, -0.026520, -0.044910, -0.056625, -0.065899, -0.070813
#*# 	  -0.049608, -0.041166, -0.034173, -0.036465, -0.039306, -0.035576, -0.027632, -0.023349, -0.022310, -0.020331, -0.012722, -0.004533, 0.000009, -0.002137, -0.003083, -0.002401, -0.001953, 0.000985, 0.001805, 0.006104, 0.008423, 0.007390, -0.002698, -0.010276, -0.014568, -0.023380, -0.038628, -0.050491, -0.058212, -0.063587
#*# 	  -0.049409, -0.041130, -0.034746, -0.037638, -0.039509, -0.037220, -0.031866, -0.027343, -0.026433, -0.022038, -0.014795, -0.005728, -0.002508, -0.003228, -0.002954, -0.003799, -0.003591, -0.000106, 0.002702, 0.007239, 0.009497, 0.006133, -0.002833, -0.008769, -0.012558, -0.020269, -0.038294, -0.049855, -0.056502, -0.063544
#*# 	  -0.049819, -0.038955, -0.030675, -0.033232, -0.037645, -0.036197, -0.031272, -0.026074, -0.025405, -0.020867, -0.015533, -0.007278, -0.002678, -0.003859, -0.003144, -0.002038, -0.002639, 0.001346, 0.006680, 0.010063, 0.010454, 0.007203, -0.001817, -0.006529, -0.009211, -0.017925, -0.034685, -0.048270, -0.055873, -0.061013
#*# 	  -0.046026, -0.032009, -0.023203, -0.025287, -0.033273, -0.035880, -0.031502, -0.027416, -0.022493, -0.020181, -0.014332, -0.007300, -0.001975, -0.004151, -0.001356, -0.001944, -0.002367, 0.001219, 0.005974, 0.009150, 0.011037, 0.005834, 0.000875, -0.002829, -0.007062, -0.017187, -0.034065, -0.043105, -0.051656, -0.058364
#*# 	  -0.042551, -0.024141, -0.008499, -0.010681, -0.023511, -0.031848, -0.028846, -0.024503, -0.020514, -0.018313, -0.013905, -0.004554, -0.000505, -0.000429, 0.002326, 0.002333, 0.001734, 0.004401, 0.007951, 0.011631, 0.012616, 0.010081, 0.004110, 0.000787, -0.003147, -0.012209, -0.025081, -0.038486, -0.045265, -0.050951
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 300.0
#*# min_y = 25.0
#*# max_y = 275.0
#*#
#*# [input_shaper]
#*#
#*# [scanner model default]
#*# model_coef = 1.5290716965117377,
#*# 	1.8660363661501966,
#*# 	0.7134648639470418,
#*# 	0.28147234342092514,
#*# 	0.5413378829152593,
#*# 	0.6713328297466867,
#*# 	-0.49133368690397666,
#*# 	-0.791764326503407,
#*# 	0.3579376435033047,
#*# 	0.4252931741317394
#*# model_domain = 3.260678818068816e-07,3.3641881239340855e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 26.538100
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.050
