
[include mainsail.cfg]

# host MCU service is preinstalled and ready to use with:
[mcu]
#serial: /tmp/klipper_host_mcu
canbus_uuid: 96438189e9b5

[mcu scanner]
canbus_uuid: 7ab466af93f3
#serial: /dev/serial/by-id/usb-cartographer_cartographer_
#    adjust to suit your scanner, if using usb change to serial
[scanner]
mcu: scanner            
#   Offsets are measured from the centre of your coil, to the tip of your nozzle 
#   on a level axis. It is vital that this is accurate. 
x_offset: 0                          
#    adjust for your cartographers offset from nozzle to middle of coil
y_offset: 23                         
#    adjust for your cartographers offset from nozzle to middle of coil
backlash_comp: 0.01122
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
sensor: cartographer
#    this must be set as cartographer unless using IDM etc.
sensor_alt: carto
#    alternate name to call commands. CARTO_TOUCH etc      
mesh_runs: 2
#    Number of passes to make during mesh scan.

[bed_mesh]
zero_reference_position: 175, 175    
#    set this to the middle of your bed
speed: 400
#    movement speed of toolhead during bed mesh
horizontal_move_z: 5
#    height of scanner during bed mesh scan
mesh_min: 50, 25
#    start point of bed mesh [X, Y]
mesh_max: 300, 275
#    end point of bed mesh [X, Y]
probe_count: 30, 30
algorithm: bicubic

[temperature_sensor Cartographer_MCU]
sensor_type: temperature_mcu
sensor_mcu: scanner
min_temp: 0
max_temp: 105

[include Manta-bigtreetech.cfg]

[include bigtreetech-EBBCan.cfg]

[include config_backup.cfg]

[include Macros.cfg]

[mcu EBBCan]
#serial /dev/serial/by-id/usb-Klipper_firmware_12345-if00
canbus_uuid: 2737fcca382f
[mcu]
#serial /dev/serial/by-id/usb-Klipper_firmware_12345-if00
canbus_uuid: 96438189e9b5

# Below you can include specific configuration files depending on what you want KAMP to do:

#[include ./KAMP/Adaptive_Meshing.cfg]       # Include to enable adaptive meshing configuration.
#[include ./KAMP/Line_Purge.cfg]             # Include to enable adaptive line purging configuration.
[include ./KAMP/Voron_Purge.cfg]            # Include to enable adaptive Voron logo purging configuration.
[include ./KAMP/Smart_Park.cfg]             # Include to enable the Smart Park function, which parks the printhead near the print area for final heating.

[gcode_macro _KAMP_Settings]
description: This macro contains all adjustable settings for KAMP 

# The following variables are settings for KAMP as a whole.
variable_verbose_enable: True               # Set to True to enable KAMP information output when running. This is useful for debugging.

# The following variables are for adjusting adaptive mesh settings for KAMP.
variable_mesh_margin: 0                     # Expands the mesh size in millimeters if desired. Leave at 0 to disable.
variable_fuzz_amount: 0                     # Slightly randomizes mesh points to spread out wear from nozzle-based probes. Leave at 0 to disable.

# The following variables are for those with a dockable probe like Klicky, Euclid, etc.                 # ----------------  Attach Macro | Detach Macro
variable_probe_dock_enable: False           # Set to True to enable the usage of a dockable probe.      # ---------------------------------------------
variable_attach_macro: 'Attach_Probe'       # The macro that is used to attach the probe.               # Klicky Probe:   'Attach_Probe' | 'Dock_Probe'
variable_detach_macro: 'Dock_Probe'         # The macro that is used to store the probe.                # Euclid Probe:   'Deploy_Probe' | 'Stow_Probe'
                                                                                                        # Legacy Gcode:   'M401'         | 'M402'

# The following variables are for adjusting adaptive purge settings for KAMP.
variable_purge_height: 0.8                  # Z position of nozzle during purge, default is 0.8.
variable_tip_distance: 0                    # Distance between tip of filament and nozzle before purge. Should be similar to PRINT_END final retract amount.
variable_purge_margin: 10                   # Distance the purge will be in front of the print area, default is 10.
variable_purge_amount: 30                   # Amount of filament to be purged prior to printing.
variable_flow_rate: 12                      # Flow rate of purge in mm3/s. Default is 12.

# The following variables are for adjusting the Smart Park feature for KAMP, which will park the printhead near the print area at a specified height.
variable_smart_park_height: 10              # Z position for Smart Park, default is 10.

gcode: # Gcode section left intentionally blank. Do not disturb.

    {action_respond_info(" Running the KAMP_Settings macro does nothing, it is only used for storing KAMP settings. ")}
#####################################################################
#	Probe
#####################################################################

#[bltouch]
#sensor_pin: ^EBBCan: PB8
#control_pin: EBBCan: PB9

## NPN and PNP proximity switch types can be set by jumper
#[probe]
#pin: ^!EBBCan: PB9
#x_offset: 0
#y_offset: 0
#z_offset: 0
#speed: 5.0     # when using induction, set to 10
#lift_speed: 10 #remove when using induction
#samples: 3
#samples_result: median
#sample_retract_dist: 3.0
#samples_tolerance: 0.006
#samples_tolerance_retries: 4
#activate_gcode:
    #{% set PROBE_TEMP = 180 %}
    #{% set MAX_TEMP = PROBE_TEMP + 5 %}
    #{% set ACTUAL_TEMP = printer.extruder.temperature %}
    #{% set TARGET_TEMP = printer.extruder.target %}

    #{% if TARGET_TEMP > PROBE_TEMP %}
        #{ action_respond_info('Extruder temperature target of %.1fC is too high, lowering to %.1fC' % (TARGET_TEMP, PROBE_TEMP)) }
        #M109 S{ PROBE_TEMP }
    #{% else %}
        # Temperature target is already low enough, but nozzle may still be too hot.
        #{% if ACTUAL_TEMP > MAX_TEMP %}
           # { action_respond_info('Extruder temperature %.1fC is still too high, waiting until below %.1fC' % (ACTUAL_TEMP, MAX_TEMP)) }
            #TEMPERATURE_WAIT SENSOR=extruder MAXIMUM={ MAX_TEMP }
        #{% endif %}
    #{% endif %}

[input_shaper]
shaper_type_x = 3hump_ei
damping_ratio_x: 0.133
shaper_freq_x = 73.2
shaper_type_y = mzv
shaper_freq_y = 34 
damping_ratio_y: 0.062

[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
# number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
# keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
# timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
# measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
# max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
# dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

[include AFC/*.cfg]

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe]
#*# z_offset = -0.830
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.017612, -0.012364, -0.003605, 0.001325, -0.000636, -0.001753, 0.000826, 0.008304, 0.016822, 0.027028, 0.039971, 0.052098, 0.055102, 0.057241, 0.059418, 0.061295, 0.064561, 0.068474, 0.072999, 0.078624, 0.084128, 0.079353, 0.073844, 0.067562, 0.060435, 0.050479, 0.034133, 0.020670, 0.011033, 0.003885
#*# 	  -0.028728, -0.017996, -0.009494, -0.001081, -0.000755, 0.000267, 0.004193, 0.009568, 0.015202, 0.024581, 0.035574, 0.046342, 0.047161, 0.049150, 0.050600, 0.053759, 0.057050, 0.059476, 0.063767, 0.060203, 0.072529, 0.069125, 0.063725, 0.056485, 0.052148, 0.042266, 0.026579, 0.013064, 0.003936, -0.012260
#*# 	  -0.028974, -0.015312, -0.007679, -0.001419, 0.001265, 0.003322, 0.009567, 0.011675, 0.015079, 0.023769, 0.034391, 0.041074, 0.048630, 0.045433, 0.050389, 0.051017, 0.053653, 0.055996, 0.059159, 0.065941, 0.070509, 0.077740, 0.060886, 0.052692, 0.047054, 0.035556, 0.018520, 0.003882, -0.004156, -0.011056
#*# 	  -0.028495, -0.015404, -0.007087, -0.005656, -0.001829, 0.000403, 0.000509, 0.011304, 0.014384, 0.022246, 0.029490, 0.037203, 0.039357, 0.039441, 0.044445, 0.042843, 0.045331, 0.049854, 0.054073, 0.059829, 0.064417, 0.060341, 0.053377, 0.044459, 0.038952, 0.028098, 0.010957, -0.001710, -0.012062, -0.019018
#*# 	  -0.027084, -0.015024, -0.009437, -0.009447, -0.008513, -0.009962, 0.004744, 0.013120, 0.016493, 0.020231, 0.029253, 0.034566, 0.039134, 0.040488, 0.036202, 0.041431, 0.043446, 0.049582, 0.051620, 0.058304, 0.063724, 0.059715, 0.051999, 0.041708, 0.034081, 0.024968, 0.007838, -0.008234, -0.017979, -0.024892
#*# 	  -0.029185, -0.020277, -0.015363, -0.007379, -0.018163, -0.011384, -0.002373, 0.004372, 0.009694, 0.013106, 0.020324, 0.027504, 0.031940, 0.045810, 0.033543, 0.033688, 0.034578, 0.040320, 0.044430, 0.047819, 0.049237, 0.047772, 0.041920, 0.031346, 0.023398, 0.014306, -0.001932, -0.016458, -0.028693, -0.035668
#*# 	  -0.029049, -0.018893, -0.014657, -0.018011, -0.019060, -0.014564, -0.003278, 0.004793, 0.007861, 0.009774, 0.017776, 0.024218, 0.028924, 0.031176, 0.030303, 0.030883, 0.031506, 0.034433, 0.028172, 0.040181, 0.042987, 0.041025, 0.034354, 0.025493, 0.019268, 0.007881, -0.009297, -0.021078, -0.035476, -0.057288
#*# 	  -0.030850, -0.030122, -0.015606, -0.019445, -0.023100, -0.016797, -0.005784, 0.001420, 0.001153, 0.003158, 0.010213, 0.018867, 0.023422, 0.026238, 0.026789, 0.026739, 0.024103, 0.025299, 0.028104, 0.031124, 0.011751, 0.029668, 0.022573, 0.013483, 0.006896, -0.002278, -0.018658, -0.034788, -0.047409, -0.055869
#*# 	  -0.020099, -0.021163, -0.016730, -0.018744, -0.020933, -0.017592, -0.008341, -0.001888, 0.000272, 0.003191, 0.006959, 0.030864, 0.020045, 0.023990, 0.026313, 0.024759, 0.022300, 0.023079, 0.025113, 0.027322, 0.046473, 0.024760, 0.018330, 0.008811, -0.000062, -0.009503, -0.025812, -0.042080, -0.054080, -0.061169
#*# 	  -0.035439, -0.017646, -0.021202, -0.025117, -0.026699, -0.022941, -0.013869, -0.019094, -0.005133, -0.003940, 0.001908, 0.007918, 0.014192, 0.016549, 0.019891, 0.019506, 0.019439, 0.020068, 0.022925, 0.024581, 0.023551, 0.020818, 0.012010, 0.002357, -0.005840, -0.016351, -0.032969, -0.048037, -0.062633, -0.070542
#*# 	  -0.039539, -0.030438, -0.024019, -0.038371, -0.041023, -0.025933, -0.018080, -0.010574, -0.007352, -0.004306, 0.000545, 0.008866, 0.013059, 0.002874, 0.020146, 0.018352, 0.017630, 0.017100, 0.018911, 0.021950, 0.021737, 0.019261, 0.008989, -0.004481, -0.013910, -0.023314, -0.039346, -0.055043, -0.067273, -0.077288
#*# 	  -0.040250, -0.031832, -0.024030, -0.028220, -0.030269, -0.009980, -0.016812, -0.010467, -0.007954, -0.004938, -0.000627, 0.008033, 0.013943, 0.013573, 0.034188, 0.016802, 0.015292, 0.015912, 0.015237, 0.016827, 0.018069, 0.014743, 0.004358, -0.007009, -0.016778, -0.026811, -0.043550, -0.057247, -0.070498, -0.081391
#*# 	  -0.041141, -0.034530, -0.028526, -0.032018, -0.035389, -0.031231, -0.014162, -0.017161, -0.014753, -0.012711, -0.006357, 0.001968, 0.006299, 0.007071, 0.008196, 0.008839, 0.006861, 0.006576, 0.006431, 0.009160, 0.010498, 0.007105, -0.004186, -0.017564, -0.025827, -0.037782, -0.053387, -0.068626, -0.079817, -0.089831
#*# 	  -0.039547, -0.033046, -0.027338, -0.031011, -0.034717, -0.030099, -0.022646, -0.017205, -0.014181, -0.012801, -0.008494, 0.000704, -0.008105, 0.006519, 0.006065, 0.007533, 0.006551, 0.006577, 0.007050, 0.010304, 0.008579, -0.010474, -0.005080, -0.019219, -0.027669, -0.037302, -0.053078, -0.066577, -0.078165, -0.089488
#*# 	  -0.041631, -0.034013, -0.030107, -0.032571, -0.037023, -0.032473, -0.026406, -0.019592, -0.017168, -0.016161, -0.011164, -0.002798, 0.000741, 0.001372, 0.001859, 0.001514, 0.001776, 0.001342, 0.003149, 0.021119, 0.006969, 0.002981, -0.007038, -0.021367, -0.030128, -0.040666, -0.054768, -0.068648, -0.081050, -0.066318
#*# 	  -0.044146, -0.036382, -0.031975, -0.034901, -0.037519, -0.033559, -0.026484, -0.022622, -0.019872, -0.019686, -0.015719, -0.006989, -0.003845, -0.003609, -0.003964, -0.003867, -0.003043, -0.003633, -0.000337, 0.018322, 0.002761, -0.001502, -0.010797, -0.021954, -0.031331, -0.040962, -0.056484, -0.069556, -0.079067, -0.089254
#*# 	  -0.048933, -0.041586, -0.036123, -0.037677, -0.039135, -0.034892, -0.030154, -0.024115, -0.024374, -0.024397, -0.019576, -0.011160, -0.019082, -0.008281, -0.007167, -0.006532, -0.008813, -0.007879, -0.006674, -0.001167, 0.001266, -0.021751, -0.014847, -0.028342, -0.034935, -0.046142, -0.062849, -0.075848, -0.083618, -0.090077
#*# 	  -0.046303, -0.037910, -0.027894, -0.033891, -0.034986, -0.029916, -0.018425, -0.023797, -0.022239, -0.022282, -0.018033, -0.008057, -0.005060, -0.004415, -0.004532, -0.005787, -0.004748, -0.004904, -0.000393, 0.003995, 0.004859, 0.000390, -0.012348, -0.021424, -0.030248, -0.042498, -0.059179, -0.073033, -0.081215, -0.087606
#*# 	  -0.048120, -0.039492, -0.034804, -0.036401, -0.036232, -0.028648, -0.032870, -0.027447, -0.026864, -0.025307, -0.021045, -0.012973, -0.009211, -0.008654, 0.000580, -0.008190, -0.009031, -0.009348, -0.004496, 0.000045, 0.002464, -0.000733, -0.012002, -0.022837, -0.032466, -0.048126, -0.065970, -0.079145, -0.084986, -0.092203
#*# 	  -0.053928, -0.044806, -0.038165, -0.037613, -0.037132, -0.034928, -0.031415, -0.027815, -0.025931, -0.025133, -0.018893, -0.014310, -0.008765, -0.016371, -0.009353, -0.011217, -0.010212, -0.008472, -0.005903, -0.000440, 0.001878, -0.001138, -0.010499, -0.020854, -0.032108, -0.045594, -0.061648, -0.072419, -0.082464, -0.090852
#*# 	  -0.050541, -0.040779, -0.035572, -0.038686, -0.039785, -0.039322, -0.034033, -0.033777, -0.026926, -0.023604, -0.018669, -0.011639, -0.008086, -0.009107, -0.010262, -0.010713, -0.010894, -0.010580, -0.005920, -0.000801, 0.001907, 0.000319, -0.009945, -0.021063, -0.030702, -0.044562, -0.060633, -0.072319, -0.081165, -0.089097
#*# 	  -0.048779, -0.037246, -0.032540, -0.034266, -0.037314, -0.034003, -0.028720, -0.024515, -0.021994, -0.019960, -0.014178, -0.005970, -0.003069, -0.005635, -0.005782, -0.007326, -0.006714, -0.006282, -0.003927, 0.003468, 0.010800, 0.002496, -0.007360, -0.017068, -0.026259, -0.036296, -0.052105, -0.064836, -0.072225, -0.080115
#*# 	  -0.050538, -0.042064, -0.039689, -0.041890, -0.041335, -0.039476, -0.033168, -0.026088, -0.022755, -0.019487, -0.013909, -0.006149, -0.003765, -0.005058, -0.005258, -0.006955, -0.007448, -0.007454, -0.003912, 0.001424, -0.002200, 0.000084, -0.009115, -0.018045, -0.025756, -0.037330, -0.051499, -0.073628, -0.070966, -0.077022
#*# 	  -0.050382, -0.040918, -0.038761, -0.040839, -0.042642, -0.039951, -0.032999, -0.026521, -0.021956, -0.020193, -0.012394, -0.003600, 0.000081, -0.000371, -0.002114, -0.005209, -0.004236, -0.002808, -0.005881, 0.004831, 0.004419, 0.001244, -0.006446, -0.014897, -0.022785, -0.033368, -0.048205, -0.061543, -0.069159, -0.074339
#*# 	  -0.051941, -0.041610, -0.037005, -0.037122, -0.039998, -0.035858, -0.028890, -0.023760, -0.022069, -0.019698, -0.011913, -0.004016, -0.000893, -0.000029, -0.002174, -0.003110, -0.003213, -0.000867, 0.002015, 0.004480, 0.006359, 0.004044, -0.004469, -0.015831, -0.022884, -0.032294, -0.047600, -0.061854, -0.068183, -0.073892
#*# 	  -0.052886, -0.042989, -0.035992, -0.038116, -0.040179, -0.037361, -0.027063, -0.023495, -0.020163, -0.017837, -0.008625, -0.001067, 0.001942, -0.000527, -0.000235, -0.002993, -0.000377, 0.002251, 0.006228, 0.008789, 0.010158, 0.009654, -0.001733, -0.010359, -0.014502, -0.025706, -0.040496, -0.051917, -0.059520, -0.065555
#*# 	  -0.051340, -0.040761, -0.036688, -0.038006, -0.039731, -0.035097, -0.030010, -0.024521, -0.023428, -0.019621, -0.011463, -0.002930, -0.000232, 0.000478, 0.001382, -0.001178, 0.001788, 0.005584, 0.008141, 0.011184, 0.013014, 0.008630, -0.000599, -0.008533, -0.009495, -0.020648, -0.041422, -0.051311, -0.054458, -0.062169
#*# 	  -0.051146, -0.040523, -0.033024, -0.034030, -0.036155, -0.032619, -0.027035, -0.022738, -0.020445, -0.017092, -0.010605, -0.002741, 0.000564, 0.001200, 0.001711, 0.000275, 0.003725, 0.006581, 0.013983, 0.016488, 0.016424, 0.011761, 0.003271, -0.001759, -0.005262, -0.016339, -0.035208, -0.047977, -0.053654, -0.059968
#*# 	  -0.046948, -0.033008, -0.026276, -0.026953, -0.032373, -0.030644, -0.025882, -0.020422, -0.016757, -0.013554, -0.006320, 0.000202, 0.005279, 0.006316, 0.007270, 0.004946, 0.006436, 0.010439, 0.014655, 0.018373, 0.017850, 0.011750, 0.007457, 0.002810, -0.001619, -0.011957, -0.029392, -0.041686, -0.048495, -0.055816
#*# 	  -0.043707, -0.027442, -0.012455, -0.013846, -0.025050, -0.028390, -0.024006, -0.018081, -0.016187, -0.013437, -0.007792, 0.000637, 0.005863, 0.005951, 0.009016, 0.008796, 0.009561, 0.012760, 0.016035, 0.020296, 0.020428, 0.016845, 0.010198, 0.007011, 0.004803, -0.006809, -0.021866, -0.034019, -0.041653, -0.048362
#*# x_count = 30
#*# y_count = 30
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 300.0
#*# min_y = 25.0
#*# max_y = 275.0
#*#
#*# [input_shaper]
#*#
#*# [scanner model default]
#*# model_coef = 1.5290716965117377,
#*# 	1.8660363661501966,
#*# 	0.7134648639470418,
#*# 	0.28147234342092514,
#*# 	0.5413378829152593,
#*# 	0.6713328297466867,
#*# 	-0.49133368690397666,
#*# 	-0.791764326503407,
#*# 	0.3579376435033047,
#*# 	0.4252931741317394
#*# model_domain = 3.260678818068816e-07,3.3641881239340855e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 26.538100
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.1.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1750
#*# scanner_touch_speed = 3
#*# scanner_touch_z_offset = 0.000
